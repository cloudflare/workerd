using Workerd = import "/workerd/workerd.capnp";

const unitTests :Workerd.Config = (
  services = [
    ( name = "queue-test",
      worker = (
        modules = [
          ( name = "worker", esModule = embed "queue-test.js" )
        ],
        bindings = [
          ( name = "QUEUE", queue = "queue-test" ),
          ( name = "SERVICE", service = "queue-test" ),
        ],
        compatibilityFlags = ["nodejs_compat", "service_binding_extra_handlers", "queues_json_messages", "rpc", "capture_async_api_throws", "disable_fast_jsg_struct"],
      )
    ),
    ( name = "queue-error-codes-enabled",
      worker = (
        modules = [
          ( name = "worker-error-codes-enabled", esModule = embed "queue-error-codes-test.js" )
        ],
        bindings = [
          ( name = "QUEUE", queue = "queue-error-codes-enabled" ),
          ( name = "ERROR_CODES_FLAG", json = "true" ),
        ],
        compatibilityFlags = ["nodejs_compat", "service_binding_extra_handlers", "queues_json_messages", "queue_expose_error_codes", "rpc", "capture_async_api_throws", "disable_fast_jsg_struct"],
      )
    ),
    ( name = "queue-error-codes-disabled",
      worker = (
        modules = [
          ( name = "worker-error-codes-disabled", esModule = embed "queue-error-codes-test.js" )
        ],
        bindings = [
          ( name = "QUEUE", queue = "queue-error-codes-disabled" ),
          ( name = "ERROR_CODES_FLAG", json = "false" ),
        ],
        compatibilityFlags = ["nodejs_compat", "service_binding_extra_handlers", "queues_json_messages", "rpc", "capture_async_api_throws", "disable_fast_jsg_struct"],
      )
    ),
  ],
);
