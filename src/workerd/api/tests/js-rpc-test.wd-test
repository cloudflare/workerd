using Workerd = import "/workerd/workerd.capnp";

const unitTests :Workerd.Config = (
  services = [
    ( name = "js-rpc-test",
      worker = (
        modules = [
          (name = "worker", esModule = embed "js-rpc-test.js")
        ],
        compatibilityFlags = [
          "nodejs_compat",
          "fetcher_no_get_put_delete",
          "enable_abortsignal_rpc",
          "enhanced_error_serialization",
          "enable_ctx_exports",
          "experimental",
          "streams_enable_constructors",
          "http_headers_getsetcookie",
          "fetch_legacy_url",
        ],
        bindings = [
          (name = "self", service = (name = "js-rpc-test", entrypoint = "nonClass")),
          (name = "MyService", service = (name = "js-rpc-test", entrypoint = "MyService")),
          (name = "MyServiceProxy", service = (name = "js-rpc-test", entrypoint = "MyServiceProxy")),
          (name = "MyActor", durableObjectNamespace = "MyActor"),
          (name = "ActorNoExtends", durableObjectNamespace = "ActorNoExtends"),
          (name = "defaultExport", service = "js-rpc-test"),
          (name = "twelve", json = "12"),
          (name = "GreeterFactory", service = (name = "js-rpc-test", entrypoint = "GreeterFactory")),
        ],

        durableObjectNamespaces = [
          (className = "MyActor", uniqueKey = "foo"),
          (className = "ActorNoExtends", uniqueKey = "bar"),
        ],

        durableObjectStorage = (inMemory = void),
      )
    ),
  ],
  v8Flags = [ "--expose-gc" ],
);
