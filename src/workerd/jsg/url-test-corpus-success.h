// Generated from the corpus of success-case url tests in WPT
test("http://example\t.\norg"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://example.org/"_kj);
test("http://user:pass@foo:21/bar;par?b#c"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://user:pass@foo:21/bar;par?b#c"_kj);
test("https://test:@test"_kj, kj::none, "https://test@test/"_kj);
test("https://:@test"_kj, kj::none, "https://test/"_kj);
test("non-special://test:@test/x"_kj, kj::none, "non-special://test@test/x"_kj);
test("non-special://:@test/x"_kj, kj::none, "non-special://test/x"_kj);
test("http:foo.com"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://example.org/foo/foo.com"_kj);
test("\t   :foo.com   \n"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://example.org/foo/:foo.com"_kj);
test(" foo.com  "_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://example.org/foo/foo.com"_kj);
test("a:\t foo.com"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "a: foo.com"_kj);
test("http://f:21/ b ? d # e "_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://f:21/%20b%20?%20d%20#%20e"_kj);
test("lolscheme:x x#x x"_kj, kj::none, "lolscheme:x x#x%20x"_kj);
test("http://f:/c"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://f/c"_kj);
test("http://f:0/c"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://f:0/c"_kj);
test("http://f:00000000000000/c"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://f:0/c"_kj);
test("http://f:00000000000000000000080/c"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://f/c"_kj);
test("http://f:\n/c"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://f/c"_kj);
test(""_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://example.org/foo/bar"_kj);
test("  \t"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://example.org/foo/bar"_kj);
test(":foo.com/"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://example.org/foo/:foo.com/"_kj);
test(":foo.com\\"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://example.org/foo/:foo.com/"_kj);
test(":"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://example.org/foo/:"_kj);
test(":a"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://example.org/foo/:a"_kj);
test(":/"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://example.org/foo/:/"_kj);
test(":\\"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://example.org/foo/:/"_kj);
test(":#"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://example.org/foo/:#"_kj);
test("#"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://example.org/foo/bar#"_kj);
test("#/"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://example.org/foo/bar#/"_kj);
test("#\\"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://example.org/foo/bar#\\"_kj);
test("#;?"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://example.org/foo/bar#;?"_kj);
test("?"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://example.org/foo/bar?"_kj);
test("/"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://example.org/"_kj);
test(":23"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://example.org/foo/:23"_kj);
test("/:23"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://example.org/:23"_kj);
test("\\x"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://example.org/x"_kj);
test("\\\\x\\hello"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://x/hello"_kj);
test("::"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://example.org/foo/::"_kj);
test("::23"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://example.org/foo/::23"_kj);
test("foo://"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "foo://"_kj);
test("http://a:b@c:29/d"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://a:b@c:29/d"_kj);
test("http::@c:29"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://example.org/foo/:@c:29"_kj);
test("http://&a:foo(b]c@d:2/"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://&a:foo(b%5Dc@d:2/"_kj);
test("http://::@c@d:2"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://:%3A%40c@d:2/"_kj);
test("http://foo.com:b@d/"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://foo.com:b@d/"_kj);
test("http://foo.com/\\@"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://foo.com//@"_kj);
test("http:\\\\foo.com\\"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://foo.com/"_kj);
test("http:\\\\a\\b:c\\d@foo.com\\"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://a/b:c/d@foo.com/"_kj);
test("foo:/"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "foo:/"_kj);
test("foo:/bar.com/"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "foo:/bar.com/"_kj);
test("foo://///////"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "foo://///////"_kj);
test("foo://///////bar.com/"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "foo://///////bar.com/"_kj);
test("foo:////://///"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "foo:////://///"_kj);
test("c:/foo"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "c:/foo"_kj);
test("//foo/bar"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://foo/bar"_kj);
test("http://foo/path;a??e#f#g"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://foo/path;a??e#f#g"_kj);
test("http://foo/abcd?efgh?ijkl"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://foo/abcd?efgh?ijkl"_kj);
test("http://foo/abcd#foo?bar"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://foo/abcd#foo?bar"_kj);
test("[61:24:74]:98"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://example.org/foo/[61:24:74]:98"_kj);
test("http:[61:27]/:foo"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://example.org/foo/[61:27]/:foo"_kj);
test("http://[2001::1]"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://[2001::1]/"_kj);
test("http://[::127.0.0.1]"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://[::7f00:1]/"_kj);
test("http://[0:0:0:0:0:0:13.1.68.3]"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://[::d01:4403]/"_kj);
test("http://[2001::1]:80"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://[2001::1]/"_kj);
test("http:/example.com/"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://example.org/example.com/"_kj);
test("ftp:/example.com/"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "ftp://example.com/"_kj);
test("https:/example.com/"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "https://example.com/"_kj);
test("madeupscheme:/example.com/"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "madeupscheme:/example.com/"_kj);
test("file:/example.com/"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "file:///example.com/"_kj);
test("ftps:/example.com/"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "ftps:/example.com/"_kj);
test("gopher:/example.com/"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "gopher:/example.com/"_kj);
test("ws:/example.com/"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "ws://example.com/"_kj);
test("wss:/example.com/"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "wss://example.com/"_kj);
test("data:/example.com/"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "data:/example.com/"_kj);
test("javascript:/example.com/"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "javascript:/example.com/"_kj);
test("mailto:/example.com/"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "mailto:/example.com/"_kj);
test("http:example.com/"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://example.org/foo/example.com/"_kj);
test("ftp:example.com/"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "ftp://example.com/"_kj);
test("https:example.com/"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "https://example.com/"_kj);
test("madeupscheme:example.com/"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "madeupscheme:example.com/"_kj);
test("ftps:example.com/"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "ftps:example.com/"_kj);
test("gopher:example.com/"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "gopher:example.com/"_kj);
test("ws:example.com/"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "ws://example.com/"_kj);
test("wss:example.com/"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "wss://example.com/"_kj);
test("data:example.com/"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "data:example.com/"_kj);
test("javascript:example.com/"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "javascript:example.com/"_kj);
test("mailto:example.com/"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "mailto:example.com/"_kj);
test("/a/b/c"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://example.org/a/b/c"_kj);
test("/a/ /c"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://example.org/a/%20/c"_kj);
test("/a%2fc"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://example.org/a%2fc"_kj);
test("/a/%2f/c"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://example.org/a/%2f/c"_kj);
test("#Œ≤"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://example.org/foo/bar#%CE%B2"_kj);
test("data:text/html,test#test"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "data:text/html,test#test"_kj);
test("tel:1234567890"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "tel:1234567890"_kj);
test("ssh://example.com/foo/bar.git"_kj, kj::Maybe("http://example.org/"_kj), "ssh://example.com/foo/bar.git"_kj);
test("file:c:\\foo\\bar.html"_kj, kj::Maybe("file:///tmp/mock/path"_kj), "file:///c:/foo/bar.html"_kj);
test("  File:c|////foo\\bar.html"_kj, kj::Maybe("file:///tmp/mock/path"_kj), "file:///c:////foo/bar.html"_kj);
test("C|/foo/bar"_kj, kj::Maybe("file:///tmp/mock/path"_kj), "file:///C:/foo/bar"_kj);
test("/C|\\foo\\bar"_kj, kj::Maybe("file:///tmp/mock/path"_kj), "file:///C:/foo/bar"_kj);
test("//C|/foo/bar"_kj, kj::Maybe("file:///tmp/mock/path"_kj), "file:///C:/foo/bar"_kj);
test("//server/file"_kj, kj::Maybe("file:///tmp/mock/path"_kj), "file://server/file"_kj);
test("\\\\server\\file"_kj, kj::Maybe("file:///tmp/mock/path"_kj), "file://server/file"_kj);
test("/\\server/file"_kj, kj::Maybe("file:///tmp/mock/path"_kj), "file://server/file"_kj);
test("file:///foo/bar.txt"_kj, kj::Maybe("file:///tmp/mock/path"_kj), "file:///foo/bar.txt"_kj);
test("file:///home/me"_kj, kj::Maybe("file:///tmp/mock/path"_kj), "file:///home/me"_kj);
test("//"_kj, kj::Maybe("file:///tmp/mock/path"_kj), "file:///"_kj);
test("///"_kj, kj::Maybe("file:///tmp/mock/path"_kj), "file:///"_kj);
test("///test"_kj, kj::Maybe("file:///tmp/mock/path"_kj), "file:///test"_kj);
test("file://test"_kj, kj::Maybe("file:///tmp/mock/path"_kj), "file://test/"_kj);
test("file://localhost"_kj, kj::Maybe("file:///tmp/mock/path"_kj), "file:///"_kj);
test("file://localhost/"_kj, kj::Maybe("file:///tmp/mock/path"_kj), "file:///"_kj);
test("file://localhost/test"_kj, kj::Maybe("file:///tmp/mock/path"_kj), "file:///test"_kj);
test("test"_kj, kj::Maybe("file:///tmp/mock/path"_kj), "file:///tmp/mock/test"_kj);
test("file:test"_kj, kj::Maybe("file:///tmp/mock/path"_kj), "file:///tmp/mock/test"_kj);
test("http://example.com/././foo"_kj, kj::none, "http://example.com/foo"_kj);
test("http://example.com/./.foo"_kj, kj::none, "http://example.com/.foo"_kj);
test("http://example.com/foo/."_kj, kj::none, "http://example.com/foo/"_kj);
test("http://example.com/foo/./"_kj, kj::none, "http://example.com/foo/"_kj);
test("http://example.com/foo/bar/.."_kj, kj::none, "http://example.com/foo/"_kj);
test("http://example.com/foo/bar/../"_kj, kj::none, "http://example.com/foo/"_kj);
test("http://example.com/foo/..bar"_kj, kj::none, "http://example.com/foo/..bar"_kj);
test("http://example.com/foo/bar/../ton"_kj, kj::none, "http://example.com/foo/ton"_kj);
test("http://example.com/foo/bar/../ton/../../a"_kj, kj::none, "http://example.com/a"_kj);
test("http://example.com/foo/../../.."_kj, kj::none, "http://example.com/"_kj);
test("http://example.com/foo/../../../ton"_kj, kj::none, "http://example.com/ton"_kj);
test("http://example.com/foo/%2e"_kj, kj::none, "http://example.com/foo/"_kj);
test("http://example.com/foo/%2e%2"_kj, kj::none, "http://example.com/foo/%2e%2"_kj);
test("http://example.com/foo/%2e./%2e%2e/.%2e/%2e.bar"_kj, kj::none, "http://example.com/%2e.bar"_kj);
test("http://example.com////../.."_kj, kj::none, "http://example.com//"_kj);
test("http://example.com/foo/bar//../.."_kj, kj::none, "http://example.com/foo/"_kj);
test("http://example.com/foo/bar//.."_kj, kj::none, "http://example.com/foo/bar/"_kj);
test("http://example.com/foo"_kj, kj::none, "http://example.com/foo"_kj);
test("http://example.com/%20foo"_kj, kj::none, "http://example.com/%20foo"_kj);
test("http://example.com/foo%"_kj, kj::none, "http://example.com/foo%"_kj);
test("http://example.com/foo%2"_kj, kj::none, "http://example.com/foo%2"_kj);
test("http://example.com/foo%2zbar"_kj, kj::none, "http://example.com/foo%2zbar"_kj);
test("http://example.com/foo%2√Ç¬©zbar"_kj, kj::none, "http://example.com/foo%2%C3%82%C2%A9zbar"_kj);
test("http://example.com/foo%41%7a"_kj, kj::none, "http://example.com/foo%41%7a"_kj);
test("http://example.com/foo\t¬ë%91"_kj, kj::none, "http://example.com/foo%C2%91%91"_kj);
test("http://example.com/foo%00%51"_kj, kj::none, "http://example.com/foo%00%51"_kj);
test("http://example.com/(%28:%3A%29)"_kj, kj::none, "http://example.com/(%28:%3A%29)"_kj);
test("http://example.com/%3A%3a%3C%3c"_kj, kj::none, "http://example.com/%3A%3a%3C%3c"_kj);
test("http://example.com/foo\tbar"_kj, kj::none, "http://example.com/foobar"_kj);
test("http://example.com\\\\foo\\\\bar"_kj, kj::none, "http://example.com//foo//bar"_kj);
test("http://example.com/%7Ffp3%3Eju%3Dduvgw%3Dd"_kj, kj::none, "http://example.com/%7Ffp3%3Eju%3Dduvgw%3Dd"_kj);
test("http://example.com/@asdf%40"_kj, kj::none, "http://example.com/@asdf%40"_kj);
test("http://example.com/‰Ω†Â•Ω‰Ω†Â•Ω"_kj, kj::none, "http://example.com/%E4%BD%A0%E5%A5%BD%E4%BD%A0%E5%A5%BD"_kj);
test("http://example.com/‚Ä•/foo"_kj, kj::none, "http://example.com/%E2%80%A5/foo"_kj);
test("http://example.com/Ôªø/foo"_kj, kj::none, "http://example.com/%EF%BB%BF/foo"_kj);
test("http://example.com/‚ÄÆ/foo/‚Ä≠/bar"_kj, kj::none, "http://example.com/%E2%80%AE/foo/%E2%80%AD/bar"_kj);
test("http://www.google.com/foo?bar=baz#"_kj, kj::none, "http://www.google.com/foo?bar=baz#"_kj);
test("http://www.google.com/foo?bar=baz# ¬ª"_kj, kj::none, "http://www.google.com/foo?bar=baz#%20%C2%BB"_kj);
test("data:test# ¬ª"_kj, kj::none, "data:test#%20%C2%BB"_kj);
test("http://www.google.com"_kj, kj::none, "http://www.google.com/"_kj);
test("http://192.0x00A80001"_kj, kj::none, "http://192.168.0.1/"_kj);
test("http://www/foo%2Ehtml"_kj, kj::none, "http://www/foo%2Ehtml"_kj);
test("http://www/foo/%2E/html"_kj, kj::none, "http://www/foo/html"_kj);
test("http://%25DOMAIN:foobar@foodomain.com/"_kj, kj::none, "http://%25DOMAIN:foobar@foodomain.com/"_kj);
test("http:\\\\www.google.com\\foo"_kj, kj::none, "http://www.google.com/foo"_kj);
test("http://foo:80/"_kj, kj::none, "http://foo/"_kj);
test("http://foo:81/"_kj, kj::none, "http://foo:81/"_kj);
test("httpa://foo:80/"_kj, kj::none, "httpa://foo:80/"_kj);
test("https://foo:443/"_kj, kj::none, "https://foo/"_kj);
test("https://foo:80/"_kj, kj::none, "https://foo:80/"_kj);
test("ftp://foo:21/"_kj, kj::none, "ftp://foo/"_kj);
test("ftp://foo:80/"_kj, kj::none, "ftp://foo:80/"_kj);
test("gopher://foo:70/"_kj, kj::none, "gopher://foo:70/"_kj);
test("gopher://foo:443/"_kj, kj::none, "gopher://foo:443/"_kj);
test("ws://foo:80/"_kj, kj::none, "ws://foo/"_kj);
test("ws://foo:81/"_kj, kj::none, "ws://foo:81/"_kj);
test("ws://foo:443/"_kj, kj::none, "ws://foo:443/"_kj);
test("ws://foo:815/"_kj, kj::none, "ws://foo:815/"_kj);
test("wss://foo:80/"_kj, kj::none, "wss://foo:80/"_kj);
test("wss://foo:81/"_kj, kj::none, "wss://foo:81/"_kj);
test("wss://foo:443/"_kj, kj::none, "wss://foo/"_kj);
test("wss://foo:815/"_kj, kj::none, "wss://foo:815/"_kj);
test("http:/example.com/"_kj, kj::none, "http://example.com/"_kj);
test("ftp:/example.com/"_kj, kj::none, "ftp://example.com/"_kj);
test("https:/example.com/"_kj, kj::none, "https://example.com/"_kj);
test("madeupscheme:/example.com/"_kj, kj::none, "madeupscheme:/example.com/"_kj);
test("file:/example.com/"_kj, kj::none, "file:///example.com/"_kj);
test("ftps:/example.com/"_kj, kj::none, "ftps:/example.com/"_kj);
test("gopher:/example.com/"_kj, kj::none, "gopher:/example.com/"_kj);
test("ws:/example.com/"_kj, kj::none, "ws://example.com/"_kj);
test("wss:/example.com/"_kj, kj::none, "wss://example.com/"_kj);
test("data:/example.com/"_kj, kj::none, "data:/example.com/"_kj);
test("javascript:/example.com/"_kj, kj::none, "javascript:/example.com/"_kj);
test("mailto:/example.com/"_kj, kj::none, "mailto:/example.com/"_kj);
test("http:example.com/"_kj, kj::none, "http://example.com/"_kj);
test("ftp:example.com/"_kj, kj::none, "ftp://example.com/"_kj);
test("https:example.com/"_kj, kj::none, "https://example.com/"_kj);
test("madeupscheme:example.com/"_kj, kj::none, "madeupscheme:example.com/"_kj);
test("ftps:example.com/"_kj, kj::none, "ftps:example.com/"_kj);
test("gopher:example.com/"_kj, kj::none, "gopher:example.com/"_kj);
test("ws:example.com/"_kj, kj::none, "ws://example.com/"_kj);
test("wss:example.com/"_kj, kj::none, "wss://example.com/"_kj);
test("data:example.com/"_kj, kj::none, "data:example.com/"_kj);
test("javascript:example.com/"_kj, kj::none, "javascript:example.com/"_kj);
test("mailto:example.com/"_kj, kj::none, "mailto:example.com/"_kj);
test("http:@www.example.com"_kj, kj::none, "http://www.example.com/"_kj);
test("http:/@www.example.com"_kj, kj::none, "http://www.example.com/"_kj);
test("http://@www.example.com"_kj, kj::none, "http://www.example.com/"_kj);
test("http:a:b@www.example.com"_kj, kj::none, "http://a:b@www.example.com/"_kj);
test("http:/a:b@www.example.com"_kj, kj::none, "http://a:b@www.example.com/"_kj);
test("http://a:b@www.example.com"_kj, kj::none, "http://a:b@www.example.com/"_kj);
test("http://@pple.com"_kj, kj::none, "http://pple.com/"_kj);
test("http::b@www.example.com"_kj, kj::none, "http://:b@www.example.com/"_kj);
test("http:/:b@www.example.com"_kj, kj::none, "http://:b@www.example.com/"_kj);
test("http://:b@www.example.com"_kj, kj::none, "http://:b@www.example.com/"_kj);
test("http:a:@www.example.com"_kj, kj::none, "http://a@www.example.com/"_kj);
test("http:/a:@www.example.com"_kj, kj::none, "http://a@www.example.com/"_kj);
test("http://a:@www.example.com"_kj, kj::none, "http://a@www.example.com/"_kj);
test("http://www.@pple.com"_kj, kj::none, "http://www.@pple.com/"_kj);
test("http://:@www.example.com"_kj, kj::none, "http://www.example.com/"_kj);
test("/"_kj, kj::Maybe("http://www.example.com/test"_kj), "http://www.example.com/"_kj);
test("/test.txt"_kj, kj::Maybe("http://www.example.com/test"_kj), "http://www.example.com/test.txt"_kj);
test("."_kj, kj::Maybe("http://www.example.com/test"_kj), "http://www.example.com/"_kj);
test(".."_kj, kj::Maybe("http://www.example.com/test"_kj), "http://www.example.com/"_kj);
test("test.txt"_kj, kj::Maybe("http://www.example.com/test"_kj), "http://www.example.com/test.txt"_kj);
test("./test.txt"_kj, kj::Maybe("http://www.example.com/test"_kj), "http://www.example.com/test.txt"_kj);
test("../test.txt"_kj, kj::Maybe("http://www.example.com/test"_kj), "http://www.example.com/test.txt"_kj);
test("../aaa/test.txt"_kj, kj::Maybe("http://www.example.com/test"_kj), "http://www.example.com/aaa/test.txt"_kj);
test("../../test.txt"_kj, kj::Maybe("http://www.example.com/test"_kj), "http://www.example.com/test.txt"_kj);
test("‰∏≠/test.txt"_kj, kj::Maybe("http://www.example.com/test"_kj), "http://www.example.com/%E4%B8%AD/test.txt"_kj);
test("http://www.example2.com"_kj, kj::Maybe("http://www.example.com/test"_kj), "http://www.example2.com/"_kj);
test("//www.example2.com"_kj, kj::Maybe("http://www.example.com/test"_kj), "http://www.example2.com/"_kj);
test("file:..."_kj, kj::Maybe("http://www.example.com/test"_kj), "file:///..."_kj);
test("file:.."_kj, kj::Maybe("http://www.example.com/test"_kj), "file:///"_kj);
test("file:a"_kj, kj::Maybe("http://www.example.com/test"_kj), "file:///a"_kj);
test("http://ExAmPlE.CoM"_kj, kj::Maybe("http://other.com/"_kj), "http://example.com/"_kj);
test("http://GOO‚Äã‚Å†Ôªøgoo.com"_kj, kj::Maybe("http://other.com/"_kj), "http://googoo.com/"_kj);
test("\0 http://example.com/ \r "_kj, kj::none, "http://example.com/"_kj);
test("http://www.foo„ÄÇbar.com"_kj, kj::Maybe("http://other.com/"_kj), "http://www.foo.bar.com/"_kj);
test("https://x/ÔøΩ?ÔøΩ#ÔøΩ"_kj, kj::none, "https://x/%EF%BF%BD?%EF%BF%BD#%EF%BF%BD"_kj);
test("http://ÔºßÔΩè.com"_kj, kj::Maybe("http://other.com/"_kj), "http://go.com/"_kj);
test("http://‰Ω†Â•Ω‰Ω†Â•Ω"_kj, kj::Maybe("http://other.com/"_kj), "http://xn--6qqa088eba/"_kj);
test("https://fa√ü.ExAmPlE/"_kj, kj::none, "https://xn--fa-hia.example/"_kj);
test("sc://fa√ü.ExAmPlE/"_kj, kj::none, "sc://fa%C3%9F.ExAmPlE/"_kj);
test("http://%30%78%63%30%2e%30%32%35%30.01"_kj, kj::Maybe("http://other.com/"_kj), "http://192.168.0.1/"_kj);
test("http://%30%78%63%30%2e%30%32%35%30.01%2e"_kj, kj::Maybe("http://other.com/"_kj), "http://192.168.0.1/"_kj);
test("http://ÔºêÔº∏ÔΩÉÔºêÔºéÔºêÔºíÔºïÔºêÔºéÔºêÔºë"_kj, kj::Maybe("http://other.com/"_kj), "http://192.168.0.1/"_kj);
test("http://./"_kj, kj::none, "http://./"_kj);
test("http://../"_kj, kj::none, "http://../"_kj);
test("h://."_kj, kj::none, "h://."_kj);
test("http://foo:üí©@example.com/bar"_kj, kj::Maybe("http://other.com/"_kj), "http://foo:%F0%9F%92%A9@example.com/bar"_kj);
test("#"_kj, kj::Maybe("test:test"_kj), "test:test#"_kj);
test("#x"_kj, kj::Maybe("mailto:x@x.com"_kj), "mailto:x@x.com#x"_kj);
test("#x"_kj, kj::Maybe("data:,"_kj), "data:,#x"_kj);
test("#x"_kj, kj::Maybe("about:blank"_kj), "about:blank#x"_kj);
test("#x:y"_kj, kj::Maybe("about:blank"_kj), "about:blank#x:y"_kj);
test("#"_kj, kj::Maybe("test:test?test"_kj), "test:test?test#"_kj);
test("https://@test@test@example:800/"_kj, kj::Maybe("http://doesnotmatter/"_kj), "https://%40test%40test@example:800/"_kj);
test("https://@@@example"_kj, kj::Maybe("http://doesnotmatter/"_kj), "https://%40%40@example/"_kj);
test("http://`{}:`{}@h/`{}?`{}"_kj, kj::Maybe("http://doesnotmatter/"_kj), "http://%60%7B%7D:%60%7B%7D@h/%60%7B%7D?`{}"_kj);
test("http://host/?'"_kj, kj::none, "http://host/?%27"_kj);
test("notspecial://host/?'"_kj, kj::none, "notspecial://host/?'"_kj);
test("/some/path"_kj, kj::Maybe("http://user@example.org/smth"_kj), "http://user@example.org/some/path"_kj);
test(""_kj, kj::Maybe("http://user:pass@example.org:21/smth"_kj), "http://user:pass@example.org:21/smth"_kj);
test("/some/path"_kj, kj::Maybe("http://user:pass@example.org:21/smth"_kj), "http://user:pass@example.org:21/some/path"_kj);
test("i"_kj, kj::Maybe("sc:/pa/pa"_kj), "sc:/pa/i"_kj);
test("i"_kj, kj::Maybe("sc://ho/pa"_kj), "sc://ho/i"_kj);
test("i"_kj, kj::Maybe("sc:///pa/pa"_kj), "sc:///pa/i"_kj);
test("../i"_kj, kj::Maybe("sc:/pa/pa"_kj), "sc:/i"_kj);
test("../i"_kj, kj::Maybe("sc://ho/pa"_kj), "sc://ho/i"_kj);
test("../i"_kj, kj::Maybe("sc:///pa/pa"_kj), "sc:///i"_kj);
test("/i"_kj, kj::Maybe("sc:/pa/pa"_kj), "sc:/i"_kj);
test("/i"_kj, kj::Maybe("sc://ho/pa"_kj), "sc://ho/i"_kj);
test("/i"_kj, kj::Maybe("sc:///pa/pa"_kj), "sc:///i"_kj);
test("?i"_kj, kj::Maybe("sc:/pa/pa"_kj), "sc:/pa/pa?i"_kj);
test("?i"_kj, kj::Maybe("sc://ho/pa"_kj), "sc://ho/pa?i"_kj);
test("?i"_kj, kj::Maybe("sc:///pa/pa"_kj), "sc:///pa/pa?i"_kj);
test("#i"_kj, kj::Maybe("sc:sd"_kj), "sc:sd#i"_kj);
test("#i"_kj, kj::Maybe("sc:sd/sd"_kj), "sc:sd/sd#i"_kj);
test("#i"_kj, kj::Maybe("sc:/pa/pa"_kj), "sc:/pa/pa#i"_kj);
test("#i"_kj, kj::Maybe("sc://ho/pa"_kj), "sc://ho/pa#i"_kj);
test("#i"_kj, kj::Maybe("sc:///pa/pa"_kj), "sc:///pa/pa#i"_kj);
test("about:/../"_kj, kj::none, "about:/"_kj);
test("data:/../"_kj, kj::none, "data:/"_kj);
test("javascript:/../"_kj, kj::none, "javascript:/"_kj);
test("mailto:/../"_kj, kj::none, "mailto:/"_kj);
test("sc://√±.test/"_kj, kj::none, "sc://%C3%B1.test/"_kj);
test("sc://%/"_kj, kj::none, "sc://%/"_kj);
test("x"_kj, kj::Maybe("sc://√±"_kj), "sc://%C3%B1/x"_kj);
test("sc:\\../"_kj, kj::none, "sc:\\../"_kj);
test("sc::a@example.net"_kj, kj::none, "sc::a@example.net"_kj);
test("wow:%NBD"_kj, kj::none, "wow:%NBD"_kj);
test("wow:%1G"_kj, kj::none, "wow:%1G"_kj);
test("wow:Ôøø"_kj, kj::none, "wow:%EF%BF%BF"_kj);
test("http://example.com/ÔøΩêüæÔøΩÔ∑êÔ∑èÔ∑ØÔ∑∞ÔøæÔøø?ÔøΩêüæÔøΩÔ∑êÔ∑èÔ∑ØÔ∑∞ÔøæÔøø"_kj, kj::none, "http://example.com/%EF%BF%BD%F0%90%9F%BE%EF%BF%BD%EF%B7%90%EF%B7%8F%EF%B7%AF%EF%B7%B0%EF%BF%BE%EF%BF%BF?%EF%BF%BD%F0%90%9F%BE%EF%BF%BD%EF%B7%90%EF%B7%8F%EF%B7%AF%EF%B7%B0%EF%BF%BE%EF%BF%BF"_kj);
test("foo://ho\tst/"_kj, kj::none, "foo://host/"_kj);
test("foo://ho\nst/"_kj, kj::none, "foo://host/"_kj);
test("foo://ho\rst/"_kj, kj::none, "foo://host/"_kj);
test("http://ho\tst/"_kj, kj::none, "http://host/"_kj);
test("http://ho\nst/"_kj, kj::none, "http://host/"_kj);
test("http://ho\rst/"_kj, kj::none, "http://host/"_kj);
test("http://!\"$&'()*+,-.;=_`{}~/"_kj, kj::none, "http://!\"$&'()*+,-.;=_`{}~/"_kj);
test("sc://!\"$%&'()*+,-.;=_`{}~/"_kj, kj::none, "sc://%01%02%03%04%05%06%07%08%0B%0C%0E%0F%10%11%12%13%14%15%16%17%18%19%1A%1B%1C%1D%1E%1F%7F!\"$%&'()*+,-.;=_`{}~/"_kj);
test("ftp://%e2%98%83"_kj, kj::none, "ftp://xn--n3h/"_kj);
test("https://%e2%98%83"_kj, kj::none, "https://xn--n3h/"_kj);
test("http://127.0.0.1:10100/relative_import.html"_kj, kj::none, "http://127.0.0.1:10100/relative_import.html"_kj);
test("http://facebook.com/?foo=%7B%22abc%22"_kj, kj::none, "http://facebook.com/?foo=%7B%22abc%22"_kj);
test("https://localhost:3000/jqueryui@1.2.3"_kj, kj::none, "https://localhost:3000/jqueryui@1.2.3"_kj);
test("h\tt\nt\rp://h\to\ns\rt:9\t0\n0\r0/p\ta\nt\rh?q\tu\ne\rry#f\tr\na\rg"_kj, kj::none, "http://host:9000/path?query#frag"_kj);
test("?a=b&c=d"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://example.org/foo/bar?a=b&c=d"_kj);
test("??a=b&c=d"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://example.org/foo/bar??a=b&c=d"_kj);
test("http:"_kj, kj::Maybe("http://example.org/foo/bar"_kj), "http://example.org/foo/bar"_kj);
test("sc:"_kj, kj::Maybe("https://example.org/foo/bar"_kj), "sc:"_kj);
test("http://foo.bar/baz?qux#foobar"_kj, kj::none, "http://foo.bar/baz?qux#foo%08bar"_kj);
test("http://foo.bar/baz?qux#foo\"bar"_kj, kj::none, "http://foo.bar/baz?qux#foo%22bar"_kj);
test("http://foo.bar/baz?qux#foo<bar"_kj, kj::none, "http://foo.bar/baz?qux#foo%3Cbar"_kj);
test("http://foo.bar/baz?qux#foo>bar"_kj, kj::none, "http://foo.bar/baz?qux#foo%3Ebar"_kj);
test("http://foo.bar/baz?qux#foo`bar"_kj, kj::none, "http://foo.bar/baz?qux#foo%60bar"_kj);
test("http://1.2.3.4/"_kj, kj::Maybe("http://other.com/"_kj), "http://1.2.3.4/"_kj);
test("http://1.2.3.4./"_kj, kj::Maybe("http://other.com/"_kj), "http://1.2.3.4/"_kj);
test("http://192.168.257"_kj, kj::Maybe("http://other.com/"_kj), "http://192.168.1.1/"_kj);
test("http://192.168.257."_kj, kj::Maybe("http://other.com/"_kj), "http://192.168.1.1/"_kj);
test("http://192.168.257.com"_kj, kj::Maybe("http://other.com/"_kj), "http://192.168.257.com/"_kj);
test("http://256"_kj, kj::Maybe("http://other.com/"_kj), "http://0.0.1.0/"_kj);
test("http://256.com"_kj, kj::Maybe("http://other.com/"_kj), "http://256.com/"_kj);
test("http://999999999"_kj, kj::Maybe("http://other.com/"_kj), "http://59.154.201.255/"_kj);
test("http://999999999."_kj, kj::Maybe("http://other.com/"_kj), "http://59.154.201.255/"_kj);
test("http://999999999.com"_kj, kj::Maybe("http://other.com/"_kj), "http://999999999.com/"_kj);
test("http://10000000000.com"_kj, kj::Maybe("http://other.com/"_kj), "http://10000000000.com/"_kj);
test("http://4294967295"_kj, kj::Maybe("http://other.com/"_kj), "http://255.255.255.255/"_kj);
test("http://0xffffffff"_kj, kj::Maybe("http://other.com/"_kj), "http://255.255.255.255/"_kj);
test("https://0x.0x.0"_kj, kj::none, "https://0.0.0.0/"_kj);
test("file:///C%3A/"_kj, kj::none, "file:///C%3A/"_kj);
test("file:///C%7C/"_kj, kj::none, "file:///C%7C/"_kj);
test("asdf://%43%7C/"_kj, kj::none, "asdf://%43%7C/"_kj);
test("pix/submit.gif"_kj, kj::Maybe("file:///C:/Users/Domenic/Dropbox/GitHub/tmpvar/jsdom/test/level2/html/files/anchor.html"_kj), "file:///C:/Users/Domenic/Dropbox/GitHub/tmpvar/jsdom/test/level2/html/files/pix/submit.gif"_kj);
test(".."_kj, kj::Maybe("file:///C:/"_kj), "file:///C:/"_kj);
test(".."_kj, kj::Maybe("file:///"_kj), "file:///"_kj);
test("/"_kj, kj::Maybe("file:///C:/a/b"_kj), "file:///C:/"_kj);
test("/"_kj, kj::Maybe("file://h/C:/a/b"_kj), "file://h/C:/"_kj);
test("/"_kj, kj::Maybe("file://h/a/b"_kj), "file://h/"_kj);
test("//d:"_kj, kj::Maybe("file:///C:/a/b"_kj), "file:///d:"_kj);
test("//d:/.."_kj, kj::Maybe("file:///C:/a/b"_kj), "file:///d:/"_kj);
test(".."_kj, kj::Maybe("file:///ab:/"_kj), "file:///"_kj);
test(".."_kj, kj::Maybe("file:///1:/"_kj), "file:///"_kj);
test(""_kj, kj::Maybe("file:///test?test#test"_kj), "file:///test?test"_kj);
test("file:"_kj, kj::Maybe("file:///test?test#test"_kj), "file:///test?test"_kj);
test("?x"_kj, kj::Maybe("file:///test?test#test"_kj), "file:///test?x"_kj);
test("file:?x"_kj, kj::Maybe("file:///test?test#test"_kj), "file:///test?x"_kj);
test("#x"_kj, kj::Maybe("file:///test?test#test"_kj), "file:///test?test#x"_kj);
test("file:#x"_kj, kj::Maybe("file:///test?test#test"_kj), "file:///test?test#x"_kj);
test("file:\\\\//"_kj, kj::none, "file:////"_kj);
test("file:\\\\\\\\"_kj, kj::none, "file:////"_kj);
test("file:\\\\\\\\?fox"_kj, kj::none, "file:////?fox"_kj);
test("file:\\\\\\\\#guppy"_kj, kj::none, "file:////#guppy"_kj);
test("file://spider///"_kj, kj::none, "file://spider///"_kj);
test("file:\\\\localhost//"_kj, kj::none, "file:////"_kj);
test("file:///localhost//cat"_kj, kj::none, "file:///localhost//cat"_kj);
test("file://\\/localhost//cat"_kj, kj::none, "file:////localhost//cat"_kj);
test("file://localhost//a//../..//"_kj, kj::none, "file://///"_kj);
test("/////mouse"_kj, kj::Maybe("file:///elephant"_kj), "file://///mouse"_kj);
test("\\//pig"_kj, kj::Maybe("file://lion/"_kj), "file:///pig"_kj);
test("\\/localhost//pig"_kj, kj::Maybe("file://lion/"_kj), "file:////pig"_kj);
test("//localhost//pig"_kj, kj::Maybe("file://lion/"_kj), "file:////pig"_kj);
test("/..//localhost//pig"_kj, kj::Maybe("file://lion/"_kj), "file://lion//localhost//pig"_kj);
test("file://"_kj, kj::Maybe("file://ape/"_kj), "file:///"_kj);
test("/rooibos"_kj, kj::Maybe("file://tea/"_kj), "file://tea/rooibos"_kj);
test("/?chai"_kj, kj::Maybe("file://tea/"_kj), "file://tea/?chai"_kj);
test("C|"_kj, kj::Maybe("file://host/dir/file"_kj), "file://host/C:"_kj);
test("C|"_kj, kj::Maybe("file://host/D:/dir1/dir2/file"_kj), "file://host/C:"_kj);
test("C|#"_kj, kj::Maybe("file://host/dir/file"_kj), "file://host/C:#"_kj);
test("C|?"_kj, kj::Maybe("file://host/dir/file"_kj), "file://host/C:?"_kj);
test("C|/"_kj, kj::Maybe("file://host/dir/file"_kj), "file://host/C:/"_kj);
test("C|\n/"_kj, kj::Maybe("file://host/dir/file"_kj), "file://host/C:/"_kj);
test("C|\\"_kj, kj::Maybe("file://host/dir/file"_kj), "file://host/C:/"_kj);
test("C"_kj, kj::Maybe("file://host/dir/file"_kj), "file://host/dir/C"_kj);
test("C|a"_kj, kj::Maybe("file://host/dir/file"_kj), "file://host/dir/C|a"_kj);
test("/c:/foo/bar"_kj, kj::Maybe("file:///c:/baz/qux"_kj), "file:///c:/foo/bar"_kj);
test("/c|/foo/bar"_kj, kj::Maybe("file:///c:/baz/qux"_kj), "file:///c:/foo/bar"_kj);
test("file:\\c:\\foo\\bar"_kj, kj::Maybe("file:///c:/baz/qux"_kj), "file:///c:/foo/bar"_kj);
test("/c:/foo/bar"_kj, kj::Maybe("file://host/path"_kj), "file://host/c:/foo/bar"_kj);
test("file://example.net/C:/"_kj, kj::none, "file://example.net/C:/"_kj);
test("file://1.2.3.4/C:/"_kj, kj::none, "file://1.2.3.4/C:/"_kj);
test("file://[1::8]/C:/"_kj, kj::none, "file://[1::8]/C:/"_kj);
test("C|/"_kj, kj::Maybe("file://host/"_kj), "file://host/C:/"_kj);
test("/C:/"_kj, kj::Maybe("file://host/"_kj), "file://host/C:/"_kj);
test("file:C:/"_kj, kj::Maybe("file://host/"_kj), "file://host/C:/"_kj);
test("file:/C:/"_kj, kj::Maybe("file://host/"_kj), "file://host/C:/"_kj);
test("//C:/"_kj, kj::Maybe("file://host/"_kj), "file:///C:/"_kj);
test("file://C:/"_kj, kj::Maybe("file://host/"_kj), "file:///C:/"_kj);
test("///C:/"_kj, kj::Maybe("file://host/"_kj), "file:///C:/"_kj);
test("file:///C:/"_kj, kj::Maybe("file://host/"_kj), "file:///C:/"_kj);
test("file:/C|/"_kj, kj::none, "file:///C:/"_kj);
test("file://C|/"_kj, kj::none, "file:///C:/"_kj);
test("file:"_kj, kj::none, "file:///"_kj);
test("file:?q=v"_kj, kj::none, "file:///?q=v"_kj);
test("file:#frag"_kj, kj::none, "file:///#frag"_kj);
test("file:///Y:"_kj, kj::none, "file:///Y:"_kj);
test("file:///Y:/"_kj, kj::none, "file:///Y:/"_kj);
test("file:///./Y"_kj, kj::none, "file:///Y"_kj);
test("file:///./Y:"_kj, kj::none, "file:///Y:"_kj);
test("file:///y:"_kj, kj::none, "file:///y:"_kj);
test("file:///y:/"_kj, kj::none, "file:///y:/"_kj);
test("file:///./y"_kj, kj::none, "file:///y"_kj);
test("file:///./y:"_kj, kj::none, "file:///y:"_kj);
test("file://localhost//a//../..//foo"_kj, kj::none, "file://///foo"_kj);
test("file://localhost////foo"_kj, kj::none, "file://////foo"_kj);
test("file:////foo"_kj, kj::none, "file:////foo"_kj);
test("file:///one/two"_kj, kj::Maybe("file:///"_kj), "file:///one/two"_kj);
test("file:////one/two"_kj, kj::Maybe("file:///"_kj), "file:////one/two"_kj);
test("//one/two"_kj, kj::Maybe("file:///"_kj), "file://one/two"_kj);
test("///one/two"_kj, kj::Maybe("file:///"_kj), "file:///one/two"_kj);
test("////one/two"_kj, kj::Maybe("file:///"_kj), "file:////one/two"_kj);
test("file:///.//"_kj, kj::Maybe("file:////"_kj), "file:////"_kj);
test("file:.//p"_kj, kj::none, "file:////p"_kj);
test("file:/.//p"_kj, kj::none, "file:////p"_kj);
test("http://[1:0::]"_kj, kj::Maybe("http://example.net/"_kj), "http://[1::]/"_kj);
test("sc://√±"_kj, kj::none, "sc://%C3%B1"_kj);
test("sc://√±?x"_kj, kj::none, "sc://%C3%B1?x"_kj);
test("sc://√±#x"_kj, kj::none, "sc://%C3%B1#x"_kj);
test("#x"_kj, kj::Maybe("sc://√±"_kj), "sc://%C3%B1#x"_kj);
test("?x"_kj, kj::Maybe("sc://√±"_kj), "sc://%C3%B1?x"_kj);
test("sc://?"_kj, kj::none, "sc://?"_kj);
test("sc://#"_kj, kj::none, "sc://#"_kj);
test("///"_kj, kj::Maybe("sc://x/"_kj), "sc:///"_kj);
test("////"_kj, kj::Maybe("sc://x/"_kj), "sc:////"_kj);
test("////x/"_kj, kj::Maybe("sc://x/"_kj), "sc:////x/"_kj);
test("tftp://foobar.com/someconfig;mode=netascii"_kj, kj::none, "tftp://foobar.com/someconfig;mode=netascii"_kj);
test("telnet://user:pass@foobar.com:23/"_kj, kj::none, "telnet://user:pass@foobar.com:23/"_kj);
test("ut2004://10.10.10.10:7777/Index.ut2"_kj, kj::none, "ut2004://10.10.10.10:7777/Index.ut2"_kj);
test("redis://foo:bar@somehost:6379/0?baz=bam&qux=baz"_kj, kj::none, "redis://foo:bar@somehost:6379/0?baz=bam&qux=baz"_kj);
test("rsync://foo@host:911/sup"_kj, kj::none, "rsync://foo@host:911/sup"_kj);
test("git://github.com/foo/bar.git"_kj, kj::none, "git://github.com/foo/bar.git"_kj);
test("irc://myserver.com:6999/channel?passwd"_kj, kj::none, "irc://myserver.com:6999/channel?passwd"_kj);
test("dns://fw.example.org:9999/foo.bar.org?type=TXT"_kj, kj::none, "dns://fw.example.org:9999/foo.bar.org?type=TXT"_kj);
test("ldap://localhost:389/ou=People,o=JNDITutorial"_kj, kj::none, "ldap://localhost:389/ou=People,o=JNDITutorial"_kj);
test("git+https://github.com/foo/bar"_kj, kj::none, "git+https://github.com/foo/bar"_kj);
test("urn:ietf:rfc:2648"_kj, kj::none, "urn:ietf:rfc:2648"_kj);
test("tag:joe@example.org,2001:foo/bar"_kj, kj::none, "tag:joe@example.org,2001:foo/bar"_kj);
test("non-spec:/.//"_kj, kj::none, "non-spec:/.//"_kj);
test("non-spec:/..//"_kj, kj::none, "non-spec:/.//"_kj);
test("non-spec:/a/..//"_kj, kj::none, "non-spec:/.//"_kj);
test("non-spec:/.//path"_kj, kj::none, "non-spec:/.//path"_kj);
test("non-spec:/..//path"_kj, kj::none, "non-spec:/.//path"_kj);
test("non-spec:/a/..//path"_kj, kj::none, "non-spec:/.//path"_kj);
test("/.//path"_kj, kj::Maybe("non-spec:/p"_kj), "non-spec:/.//path"_kj);
test("/..//path"_kj, kj::Maybe("non-spec:/p"_kj), "non-spec:/.//path"_kj);
test("..//path"_kj, kj::Maybe("non-spec:/p"_kj), "non-spec:/.//path"_kj);
test("a/..//path"_kj, kj::Maybe("non-spec:/p"_kj), "non-spec:/.//path"_kj);
test(""_kj, kj::Maybe("non-spec:/..//p"_kj), "non-spec:/.//p"_kj);
test("path"_kj, kj::Maybe("non-spec:/..//p"_kj), "non-spec:/.//path"_kj);
test("../path"_kj, kj::Maybe("non-spec:/.//p"_kj), "non-spec:/path"_kj);
test("non-special://%E2%80%A0/"_kj, kj::none, "non-special://%E2%80%A0/"_kj);
test("non-special://H%4fSt/path"_kj, kj::none, "non-special://H%4fSt/path"_kj);
test("non-special://[1:2:0:0:5:0:0:0]/"_kj, kj::none, "non-special://[1:2:0:0:5::]/"_kj);
test("non-special://[1:2:0:0:0:0:0:3]/"_kj, kj::none, "non-special://[1:2::3]/"_kj);
test("non-special://[1:2::3]:80/"_kj, kj::none, "non-special://[1:2::3]:80/"_kj);
test("blob:https://example.com:443/"_kj, kj::none, "blob:https://example.com:443/"_kj);
test("blob:http://example.org:88/"_kj, kj::none, "blob:http://example.org:88/"_kj);
test("blob:d3958f5c-0777-0845-9dcf-2cb28783acaf"_kj, kj::none, "blob:d3958f5c-0777-0845-9dcf-2cb28783acaf"_kj);
test("blob:"_kj, kj::none, "blob:"_kj);
test("blob:blob:"_kj, kj::none, "blob:blob:"_kj);
test("blob:blob:https://example.org/"_kj, kj::none, "blob:blob:https://example.org/"_kj);
test("blob:about:blank"_kj, kj::none, "blob:about:blank"_kj);
test("blob:file://host/path"_kj, kj::none, "blob:file://host/path"_kj);
test("blob:ftp://host/path"_kj, kj::none, "blob:ftp://host/path"_kj);
test("blob:ws://example.org/"_kj, kj::none, "blob:ws://example.org/"_kj);
test("blob:wss://example.org/"_kj, kj::none, "blob:wss://example.org/"_kj);
test("blob:http%3a//example.org/"_kj, kj::none, "blob:http%3a//example.org/"_kj);
test("http://0x7f.0.0.0x7g"_kj, kj::none, "http://0x7f.0.0.0x7g/"_kj);
test("http://0X7F.0.0.0X7G"_kj, kj::none, "http://0x7f.0.0.0x7g/"_kj);
test("http://[0:1:0:1:0:1:0:1]"_kj, kj::none, "http://[0:1:0:1:0:1:0:1]/"_kj);
test("http://[1:0:1:0:1:0:1:0]"_kj, kj::none, "http://[1:0:1:0:1:0:1:0]/"_kj);
test("http://example.org/test?\""_kj, kj::none, "http://example.org/test?%22"_kj);
test("http://example.org/test?#"_kj, kj::none, "http://example.org/test?#"_kj);
test("http://example.org/test?<"_kj, kj::none, "http://example.org/test?%3C"_kj);
test("http://example.org/test?>"_kj, kj::none, "http://example.org/test?%3E"_kj);
test("http://example.org/test?‚å£"_kj, kj::none, "http://example.org/test?%E2%8C%A3"_kj);
test("http://example.org/test?%23%23"_kj, kj::none, "http://example.org/test?%23%23"_kj);
test("http://example.org/test?%GH"_kj, kj::none, "http://example.org/test?%GH"_kj);
test("http://example.org/test?a#%EF"_kj, kj::none, "http://example.org/test?a#%EF"_kj);
test("http://example.org/test?a#%GH"_kj, kj::none, "http://example.org/test?a#%GH"_kj);
test("test-a-colon-slash.html"_kj, kj::Maybe("a:/"_kj), "a:/test-a-colon-slash.html"_kj);
test("test-a-colon-slash-slash.html"_kj, kj::Maybe("a://"_kj), "a:///test-a-colon-slash-slash.html"_kj);
test("test-a-colon-slash-b.html"_kj, kj::Maybe("a:/b"_kj), "a:/test-a-colon-slash-b.html"_kj);
test("test-a-colon-slash-slash-b.html"_kj, kj::Maybe("a://b"_kj), "a://b/test-a-colon-slash-slash-b.html"_kj);
test("http://example.org/test?a#b\0c"_kj, kj::none, "http://example.org/test?a#b%00c"_kj);
test("non-spec://example.org/test?a#b\0c"_kj, kj::none, "non-spec://example.org/test?a#b%00c"_kj);
test("non-spec:/test?a#b\0c"_kj, kj::none, "non-spec:/test?a#b%00c"_kj);
test("10.0.0.7:8080/foo.html"_kj, kj::Maybe("file:///some/dir/bar.html"_kj), "file:///some/dir/10.0.0.7:8080/foo.html"_kj);
test("a!@$*=/foo.html"_kj, kj::Maybe("file:///some/dir/bar.html"_kj), "file:///some/dir/a!@$*=/foo.html"_kj);
test("a1234567890-+.:foo/bar"_kj, kj::Maybe("http://example.com/dir/file"_kj), "a1234567890-+.:foo/bar"_kj);
test("file://a¬≠b/p"_kj, kj::none, "file://ab/p"_kj);
test("file://a%C2%ADb/p"_kj, kj::none, "file://ab/p"_kj);
test("file://loCùêÄùêãùêáùê®ùê¨ùê≠/usr/bin"_kj, kj::none, "file:///usr/bin"_kj);
test("#link"_kj, kj::Maybe("https://example.org/##link"_kj), "https://example.org/#link"_kj);
test("non-special:cannot-be-a-base-url-\0~¬Ä"_kj, kj::none, "non-special:cannot-be-a-base-url-%00%01%1F%1E~%7F%C2%80"_kj);
test("https://www.example.com/path{path.html?query'=query#fragment<fragment"_kj, kj::none, "https://www.example.com/path%7B%7Fpath.html?query%27%7F=query#fragment%3C%7Ffragment"_kj);
test("https://user:pass[@foo/bar"_kj, kj::Maybe("http://example.org"_kj), "https://user:pass%5B%7F@foo/bar"_kj);
test("foo:// !\"$%&'()*+,-.;<=>@[\\]^_`{|}~@host/"_kj, kj::none, "foo://%20!%22$%&'()*+,-.%3B%3C%3D%3E%40%5B%5C%5D%5E_%60%7B%7C%7D~@host/"_kj);
test("wss:// !\"$%&'()*+,-.;<=>@[]^_`{|}~@host/"_kj, kj::none, "wss://%20!%22$%&'()*+,-.%3B%3C%3D%3E%40%5B%5D%5E_%60%7B%7C%7D~@host/"_kj);
test("foo://joe: !\"$%&'()*+,-.:;<=>@[\\]^_`{|}~@host/"_kj, kj::none, "foo://joe:%20!%22$%&'()*+,-.%3A%3B%3C%3D%3E%40%5B%5C%5D%5E_%60%7B%7C%7D~@host/"_kj);
test("wss://joe: !\"$%&'()*+,-.:;<=>@[]^_`{|}~@host/"_kj, kj::none, "wss://joe:%20!%22$%&'()*+,-.%3A%3B%3C%3D%3E%40%5B%5D%5E_%60%7B%7C%7D~@host/"_kj);
test("foo://!\"$%&'()*+,-.;=_`{}~/"_kj, kj::none, "foo://!\"$%&'()*+,-.;=_`{}~/"_kj);
test("wss://!\"$&'()*+,-.;=_`{}~/"_kj, kj::none, "wss://!\"$&'()*+,-.;=_`{}~/"_kj);
test("foo://host/ !\"$%&'()*+,-./:;<=>@[\\]^_`{|}~"_kj, kj::none, "foo://host/%20!%22$%&'()*+,-./:;%3C=%3E@[\\]^_%60%7B|%7D~"_kj);
test("wss://host/ !\"$%&'()*+,-./:;<=>@[\\]^_`{|}~"_kj, kj::none, "wss://host/%20!%22$%&'()*+,-./:;%3C=%3E@[/]^_%60%7B|%7D~"_kj);
test("foo://host/dir/? !\"$%&'()*+,-./:;<=>?@[\\]^_`{|}~"_kj, kj::none, "foo://host/dir/?%20!%22$%&'()*+,-./:;%3C=%3E?@[\\]^_`{|}~"_kj);
test("wss://host/dir/? !\"$%&'()*+,-./:;<=>?@[\\]^_`{|}~"_kj, kj::none, "wss://host/dir/?%20!%22$%&%27()*+,-./:;%3C=%3E?@[\\]^_`{|}~"_kj);
test("foo://host/dir/# !\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~"_kj, kj::none, "foo://host/dir/#%20!%22#$%&'()*+,-./:;%3C=%3E?@[\\]^_%60{|}~"_kj);
test("wss://host/dir/# !\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~"_kj, kj::none, "wss://host/dir/#%20!%22#$%&'()*+,-./:;%3C=%3E?@[\\]^_%60{|}~"_kj);
test("abc:rootless"_kj, kj::Maybe("abc://host/path"_kj), "abc:rootless"_kj);
test("abc:rootless"_kj, kj::Maybe("abc:/path"_kj), "abc:rootless"_kj);
test("abc:rootless"_kj, kj::Maybe("abc:path"_kj), "abc:rootless"_kj);
test("abc:/rooted"_kj, kj::Maybe("abc://host/path"_kj), "abc:/rooted"_kj);
test("http://foo.09.."_kj, kj::none, "http://foo.09../"_kj);
test("https://x/\0y"_kj, kj::none, "https://x/%00y"_kj);
test("https://x/?\0y"_kj, kj::none, "https://x/?%00y"_kj);
test("https://x/?#\0y"_kj, kj::none, "https://x/?#%00y"_kj);
test("https://x/Ôøøy"_kj, kj::none, "https://x/%EF%BF%BFy"_kj);
test("https://x/?Ôøøy"_kj, kj::none, "https://x/?%EF%BF%BFy"_kj);
test("https://x/?#Ôøøy"_kj, kj::none, "https://x/?#%EF%BF%BFy"_kj);
test("non-special:\0y"_kj, kj::none, "non-special:%00y"_kj);
test("non-special:x/\0y"_kj, kj::none, "non-special:x/%00y"_kj);
test("non-special:x/?\0y"_kj, kj::none, "non-special:x/?%00y"_kj);
test("non-special:x/?#\0y"_kj, kj::none, "non-special:x/?#%00y"_kj);
test("non-special:Ôøøy"_kj, kj::none, "non-special:%EF%BF%BFy"_kj);
test("non-special:x/Ôøøy"_kj, kj::none, "non-special:x/%EF%BF%BFy"_kj);
test("non-special:x/?Ôøøy"_kj, kj::none, "non-special:x/?%EF%BF%BFy"_kj);
test("non-special:x/?#Ôøøy"_kj, kj::none, "non-special:x/?#%EF%BF%BFy"_kj);
test("https://example.com/\"quoted\""_kj, kj::none, "https://example.com/%22quoted%22"_kj);
test("https://a%C2%ADb/"_kj, kj::none, "https://ab/"_kj);
test("data://example.com:8080/pathname?search#hash"_kj, kj::none, "data://example.com:8080/pathname?search#hash"_kj);
test("data:///test"_kj, kj::none, "data:///test"_kj);
test("data://test/a/../b"_kj, kj::none, "data://test/b"_kj);
test("javascript://example.com:8080/pathname?search#hash"_kj, kj::none, "javascript://example.com:8080/pathname?search#hash"_kj);
test("javascript:///test"_kj, kj::none, "javascript:///test"_kj);
test("javascript://test/a/../b"_kj, kj::none, "javascript://test/b"_kj);
test("mailto://example.com:8080/pathname?search#hash"_kj, kj::none, "mailto://example.com:8080/pathname?search#hash"_kj);
test("mailto:///test"_kj, kj::none, "mailto:///test"_kj);
test("mailto://test/a/../b"_kj, kj::none, "mailto://test/b"_kj);
test("intent://example.com:8080/pathname?search#hash"_kj, kj::none, "intent://example.com:8080/pathname?search#hash"_kj);
test("intent:///test"_kj, kj::none, "intent:///test"_kj);
test("intent://test/a/../b"_kj, kj::none, "intent://test/b"_kj);
test("urn://example.com:8080/pathname?search#hash"_kj, kj::none, "urn://example.com:8080/pathname?search#hash"_kj);
test("urn:///test"_kj, kj::none, "urn:///test"_kj);
test("urn://test/a/../b"_kj, kj::none, "urn://test/b"_kj);
test("turn://example.com:8080/pathname?search#hash"_kj, kj::none, "turn://example.com:8080/pathname?search#hash"_kj);
test("turn:///test"_kj, kj::none, "turn:///test"_kj);
test("turn://test/a/../b"_kj, kj::none, "turn://test/b"_kj);
test("stun://example.com:8080/pathname?search#hash"_kj, kj::none, "stun://example.com:8080/pathname?search#hash"_kj);
test("stun:///test"_kj, kj::none, "stun:///test"_kj);
test("stun://test/a/../b"_kj, kj::none, "stun://test/b"_kj);
test("w://x:0"_kj, kj::none, "w://x:0"_kj);
test("west://x:0"_kj, kj::none, "west://x:0"_kj);
