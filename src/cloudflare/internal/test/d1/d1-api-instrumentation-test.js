// Copyright (c) 2017-2023 Cloudflare, Inc.
// Licensed under the Apache 2.0 license found in the LICENSE file or at:
//     https://opensource.org/licenses/Apache-2.0
import * as assert from 'node:assert';
import {
  createInstrumentationState,
  createTailStreamHandler,
  runInstrumentationTest,
} from 'instrumentation-test-helper';

// Create module-level state using the helper
const state = createInstrumentationState();

export default {
  tailStream: createTailStreamHandler(state),
};

export const test = {
  async test() {
    await runInstrumentationTest(state, expectedSpans, {
      testName: 'D1 instrumentation',
    });
  },
};

const expectedSpans = [
  {
    name: 'fetch',
    'network.protocol.name': 'http',
    'network.protocol.version': 'HTTP/1.1',
    'http.request.method': 'POST',
    'url.full': 'http://d1/execute?resultsFormat=NONE',
    'http.request.header.content-type': 'application/json',
    'http.request.body.size': 231n,
    'http.response.status_code': 200n,
    'http.response.body.size': 186n,
    closed: true,
  },
  {
    name: 'd1_run',
    'db.system.name': 'cloudflare-d1',
    'db.operation.name': 'run',
    'cloudflare.binding.type': 'D1',
    'cloudflare.d1.query.statement':
      ' CREATE TABLE users\n' +
      '        (\n' +
      '            user_id    INTEGER PRIMARY KEY,\n' +
      '            name       TEXT,\n' +
      '            home       TEXT,\n' +
      '            features   TEXT,\n' +
      '            land_based BOOLEAN\n' +
      '        );',
    'cloudflare.d1.response.size_after': 8192,
    'cloudflare.d1.response.rows_read': 1,
    'cloudflare.d1.response.rows_written': 2,
    'cloudflare.d1.response.last_row_id': 0,
    'cloudflare.d1.response.changed_db': true,
    'cloudflare.d1.response.changes': 0,
    closed: true,
  },
  {
    name: 'fetch',
    'network.protocol.name': 'http',
    'network.protocol.version': 'HTTP/1.1',
    'http.request.method': 'POST',
    'url.full': 'http://d1/query?resultsFormat=ROWS_AND_COLUMNS',
    'http.request.header.content-type': 'application/json',
    'http.request.body.size': 42n,
    'http.response.status_code': 200n,
    'http.response.body.size': 257n,
    closed: true,
  },
  {
    name: 'd1_all',
    'db.system.name': 'cloudflare-d1',
    'db.operation.name': 'all',
    'cloudflare.binding.type': 'D1',
    'cloudflare.d1.query.statement': 'SELECT * FROM users;',
    'cloudflare.d1.response.size_after': 8192,
    'cloudflare.d1.response.rows_read': 1,
    'cloudflare.d1.response.rows_written': 0,
    'cloudflare.d1.response.last_row_id': 0,
    'cloudflare.d1.response.changed_db': false,
    'cloudflare.d1.response.changes': 0,
    closed: true,
  },
  {
    name: 'fetch',
    'network.protocol.name': 'http',
    'network.protocol.version': 'HTTP/1.1',
    'http.request.method': 'POST',
    'url.full': 'http://d1/execute?resultsFormat=NONE',
    'http.request.header.content-type': 'application/json',
    'http.request.body.size': 42n,
    'http.response.status_code': 200n,
    'http.response.body.size': 188n,
    closed: true,
  },
  {
    name: 'd1_run',
    'db.system.name': 'cloudflare-d1',
    'db.operation.name': 'run',
    'cloudflare.binding.type': 'D1',
    'cloudflare.d1.query.statement': 'SELECT * FROM users;',
    'cloudflare.d1.response.size_after': 8192,
    'cloudflare.d1.response.rows_read': 1,
    'cloudflare.d1.response.rows_written': 0,
    'cloudflare.d1.response.last_row_id': 0,
    'cloudflare.d1.response.changed_db': false,
    'cloudflare.d1.response.changes': 0,
    closed: true,
  },
  {
    name: 'fetch',
    'network.protocol.name': 'http',
    'network.protocol.version': 'HTTP/1.1',
    'http.request.method': 'POST',
    'url.full': 'http://d1/execute?resultsFormat=NONE',
    'http.request.header.content-type': 'application/json',
    'http.request.body.size': 40n,
    'http.response.status_code': 200n,
    'http.response.body.size': 188n,
    closed: true,
  },
  {
    name: 'd1_run',
    'db.system.name': 'cloudflare-d1',
    'db.operation.name': 'run',
    'cloudflare.binding.type': 'D1',
    'cloudflare.d1.query.statement': 'DELETE FROM users;',
    'cloudflare.d1.response.size_after': 8192,
    'cloudflare.d1.response.rows_read': 0,
    'cloudflare.d1.response.rows_written': 0,
    'cloudflare.d1.response.last_row_id': 0,
    'cloudflare.d1.response.changed_db': false,
    'cloudflare.d1.response.changes': 0,
    closed: true,
  },
  {
    name: 'fetch',
    'network.protocol.name': 'http',
    'network.protocol.version': 'HTTP/1.1',
    'http.request.method': 'POST',
    'url.full': 'http://d1/query?resultsFormat=ROWS_AND_COLUMNS',
    'http.request.header.content-type': 'application/json',
    'http.request.body.size': 223n,
    'http.response.status_code': 200n,
    'http.response.body.size': 327n,
    closed: true,
  },
  {
    name: 'd1_all',
    'db.system.name': 'cloudflare-d1',
    'db.operation.name': 'all',
    'cloudflare.binding.type': 'D1',
    'cloudflare.d1.query.statement':
      '\n' +
      '        INSERT INTO users (name, home, features, land_based) VALUES\n' +
      "          ('Albert Ross', 'sky', 'wingspan', false),\n" +
      "          ('Al Dente', 'bowl', 'mouthfeel', true)\n" +
      '        RETURNING *\n' +
      '    ',
    'cloudflare.d1.response.size_after': 8192,
    'cloudflare.d1.response.rows_read': 4,
    'cloudflare.d1.response.rows_written': 2,
    'cloudflare.d1.response.last_row_id': 2,
    'cloudflare.d1.response.changed_db': true,
    'cloudflare.d1.response.changes': 2,
    closed: true,
  },
  {
    name: 'fetch',
    'network.protocol.name': 'http',
    'network.protocol.version': 'HTTP/1.1',
    'http.request.method': 'POST',
    'url.full': 'http://d1/execute?resultsFormat=NONE',
    'http.request.header.content-type': 'application/json',
    'http.request.body.size': 40n,
    'http.response.status_code': 200n,
    'http.response.body.size': 187n,
    closed: true,
  },
  {
    name: 'd1_run',
    'db.system.name': 'cloudflare-d1',
    'db.operation.name': 'run',
    'cloudflare.binding.type': 'D1',
    'cloudflare.d1.query.statement': 'DELETE FROM users;',
    'cloudflare.d1.response.size_after': 8192,
    'cloudflare.d1.response.rows_read': 0,
    'cloudflare.d1.response.rows_written': 2,
    'cloudflare.d1.response.last_row_id': 2,
    'cloudflare.d1.response.changed_db': true,
    'cloudflare.d1.response.changes': 2,
    closed: true,
  },
  {
    name: 'fetch',
    'network.protocol.name': 'http',
    'network.protocol.version': 'HTTP/1.1',
    'http.request.method': 'POST',
    'url.full': 'http://d1/execute?resultsFormat=NONE',
    'http.request.header.content-type': 'application/json',
    'http.request.body.size': 223n,
    'http.response.status_code': 200n,
    'http.response.body.size': 356n,
    closed: true,
  },
  {
    name: 'd1_run',
    'db.system.name': 'cloudflare-d1',
    'db.operation.name': 'run',
    'cloudflare.binding.type': 'D1',
    'cloudflare.d1.query.statement':
      '\n' +
      '        INSERT INTO users (name, home, features, land_based) VALUES\n' +
      "          ('Albert Ross', 'sky', 'wingspan', false),\n" +
      "          ('Al Dente', 'bowl', 'mouthfeel', true)\n" +
      '        RETURNING *\n' +
      '    ',
    'cloudflare.d1.response.size_after': 8192,
    'cloudflare.d1.response.rows_read': 4,
    'cloudflare.d1.response.rows_written': 2,
    'cloudflare.d1.response.last_row_id': 2,
    'cloudflare.d1.response.changed_db': true,
    'cloudflare.d1.response.changes': 2,
    closed: true,
  },
  {
    name: 'fetch',
    'network.protocol.name': 'http',
    'network.protocol.version': 'HTTP/1.1',
    'http.request.method': 'POST',
    'url.full': 'http://d1/query?resultsFormat=ROWS_AND_COLUMNS',
    'http.request.header.content-type': 'application/json',
    'http.request.body.size': 31n,
    'http.response.status_code': 200n,
    'http.response.body.size': 216n,
    closed: true,
  },
  {
    name: 'd1_all',
    'db.system.name': 'cloudflare-d1',
    'db.operation.name': 'all',
    'cloudflare.binding.type': 'D1',
    'cloudflare.d1.query.statement': 'select 1;',
    'cloudflare.d1.response.size_after': 8192,
    'cloudflare.d1.response.rows_read': 0,
    'cloudflare.d1.response.rows_written': 0,
    'cloudflare.d1.response.last_row_id': 2,
    'cloudflare.d1.response.changed_db': false,
    'cloudflare.d1.response.changes': 0,
    closed: true,
  },
  {
    name: 'fetch',
    'network.protocol.name': 'http',
    'network.protocol.version': 'HTTP/1.1',
    'http.request.method': 'POST',
    'url.full': 'http://d1/query?resultsFormat=ROWS_AND_COLUMNS',
    'http.request.header.content-type': 'application/json',
    'http.request.body.size': 31n,
    'http.response.status_code': 200n,
    'http.response.body.size': 217n,
    closed: true,
  },
  {
    name: 'd1_raw',
    'db.system.name': 'cloudflare-d1',
    'db.operation.name': 'raw',
    'cloudflare.binding.type': 'D1',
    'cloudflare.d1.query.statement': 'select 1;',
    'cloudflare.d1.response.size_after': 8192,
    'cloudflare.d1.response.rows_read': 0,
    'cloudflare.d1.response.rows_written': 0,
    'cloudflare.d1.response.last_row_id': 2,
    'cloudflare.d1.response.changed_db': false,
    'cloudflare.d1.response.changes': 0,
    closed: true,
  },
  {
    name: 'fetch',
    'network.protocol.name': 'http',
    'network.protocol.version': 'HTTP/1.1',
    'http.request.method': 'POST',
    'url.full': 'http://d1/query?resultsFormat=ROWS_AND_COLUMNS',
    'http.request.header.content-type': 'application/json',
    'http.request.body.size': 31n,
    'http.response.status_code': 200n,
    'http.response.body.size': 217n,
    closed: true,
  },
  {
    name: 'd1_first',
    'db.system.name': 'cloudflare-d1',
    'db.operation.name': 'first',
    'cloudflare.binding.type': 'D1',
    'cloudflare.d1.query.statement': 'select 1;',
    'cloudflare.d1.response.size_after': 8192,
    'cloudflare.d1.response.rows_read': 0,
    'cloudflare.d1.response.rows_written': 0,
    'cloudflare.d1.response.last_row_id': 2,
    'cloudflare.d1.response.changed_db': false,
    'cloudflare.d1.response.changes': 0,
    closed: true,
  },
  {
    name: 'fetch',
    'network.protocol.name': 'http',
    'network.protocol.version': 'HTTP/1.1',
    'http.request.method': 'POST',
    'url.full': 'http://d1/query?resultsFormat=ROWS_AND_COLUMNS',
    'http.request.header.content-type': 'application/json',
    'http.request.body.size': 31n,
    'http.response.status_code': 200n,
    'http.response.body.size': 217n,
    closed: true,
  },
  {
    name: 'd1_first',
    'db.system.name': 'cloudflare-d1',
    'db.operation.name': 'first',
    'cloudflare.binding.type': 'D1',
    'cloudflare.d1.query.statement': 'select 1;',
    'cloudflare.d1.response.size_after': 8192,
    'cloudflare.d1.response.rows_read': 0,
    'cloudflare.d1.response.rows_written': 0,
    'cloudflare.d1.response.last_row_id': 2,
    'cloudflare.d1.response.changed_db': false,
    'cloudflare.d1.response.changes': 0,
    closed: true,
  },
  {
    name: 'fetch',
    'network.protocol.name': 'http',
    'network.protocol.version': 'HTTP/1.1',
    'http.request.method': 'POST',
    'url.full': 'http://d1/query?resultsFormat=ROWS_AND_COLUMNS',
    'http.request.header.content-type': 'application/json',
    'http.request.body.size': 42n,
    'http.response.status_code': 200n,
    'http.response.body.size': 329n,
    closed: true,
  },
  {
    name: 'd1_all',
    'db.system.name': 'cloudflare-d1',
    'db.operation.name': 'all',
    'cloudflare.binding.type': 'D1',
    'cloudflare.d1.query.statement': 'SELECT * FROM users;',
    'cloudflare.d1.response.size_after': 8192,
    'cloudflare.d1.response.rows_read': 2,
    'cloudflare.d1.response.rows_written': 0,
    'cloudflare.d1.response.last_row_id': 2,
    'cloudflare.d1.response.changed_db': false,
    'cloudflare.d1.response.changes': 0,
    closed: true,
  },
  {
    name: 'fetch',
    'network.protocol.name': 'http',
    'network.protocol.version': 'HTTP/1.1',
    'http.request.method': 'POST',
    'url.full': 'http://d1/query?resultsFormat=ROWS_AND_COLUMNS',
    'http.request.header.content-type': 'application/json',
    'http.request.body.size': 42n,
    'http.response.status_code': 200n,
    'http.response.body.size': 329n,
    closed: true,
  },
  {
    name: 'd1_raw',
    'db.system.name': 'cloudflare-d1',
    'db.operation.name': 'raw',
    'cloudflare.binding.type': 'D1',
    'cloudflare.d1.query.statement': 'SELECT * FROM users;',
    'cloudflare.d1.response.size_after': 8192,
    'cloudflare.d1.response.rows_read': 2,
    'cloudflare.d1.response.rows_written': 0,
    'cloudflare.d1.response.last_row_id': 2,
    'cloudflare.d1.response.changed_db': false,
    'cloudflare.d1.response.changes': 0,
    closed: true,
  },
  {
    name: 'fetch',
    'network.protocol.name': 'http',
    'network.protocol.version': 'HTTP/1.1',
    'http.request.method': 'POST',
    'url.full': 'http://d1/query?resultsFormat=ROWS_AND_COLUMNS',
    'http.request.header.content-type': 'application/json',
    'http.request.body.size': 42n,
    'http.response.status_code': 200n,
    'http.response.body.size': 329n,
    closed: true,
  },
  {
    name: 'd1_first',
    'db.system.name': 'cloudflare-d1',
    'db.operation.name': 'first',
    'cloudflare.binding.type': 'D1',
    'cloudflare.d1.query.statement': 'SELECT * FROM users;',
    'cloudflare.d1.response.size_after': 8192,
    'cloudflare.d1.response.rows_read': 2,
    'cloudflare.d1.response.rows_written': 0,
    'cloudflare.d1.response.last_row_id': 2,
    'cloudflare.d1.response.changed_db': false,
    'cloudflare.d1.response.changes': 0,
    closed: true,
  },
  {
    name: 'fetch',
    'network.protocol.name': 'http',
    'network.protocol.version': 'HTTP/1.1',
    'http.request.method': 'POST',
    'url.full': 'http://d1/query?resultsFormat=ROWS_AND_COLUMNS',
    'http.request.header.content-type': 'application/json',
    'http.request.body.size': 42n,
    'http.response.status_code': 200n,
    'http.response.body.size': 330n,
    closed: true,
  },
  {
    name: 'd1_first',
    'db.system.name': 'cloudflare-d1',
    'db.operation.name': 'first',
    'cloudflare.binding.type': 'D1',
    'cloudflare.d1.query.statement': 'SELECT * FROM users;',
    'cloudflare.d1.response.size_after': 8192,
    'cloudflare.d1.response.rows_read': 2,
    'cloudflare.d1.response.rows_written': 0,
    'cloudflare.d1.response.last_row_id': 2,
    'cloudflare.d1.response.changed_db': false,
    'cloudflare.d1.response.changes': 0,
    closed: true,
  },
  {
    name: 'fetch',
    'network.protocol.name': 'http',
    'network.protocol.version': 'HTTP/1.1',
    'http.request.method': 'POST',
    'url.full': 'http://d1/query?resultsFormat=ROWS_AND_COLUMNS',
    'http.request.header.content-type': 'application/json',
    'http.request.body.size': 61n,
    'http.response.status_code': 200n,
    'http.response.body.size': 293n,
    closed: true,
  },
  {
    name: 'd1_all',
    'db.system.name': 'cloudflare-d1',
    'db.operation.name': 'all',
    'cloudflare.binding.type': 'D1',
    'cloudflare.d1.query.statement': 'SELECT * FROM users WHERE user_id = ?;',
    'cloudflare.d1.response.size_after': 8192,
    'cloudflare.d1.response.rows_read': 1,
    'cloudflare.d1.response.rows_written': 0,
    'cloudflare.d1.response.last_row_id': 2,
    'cloudflare.d1.response.changed_db': false,
    'cloudflare.d1.response.changes': 0,
    closed: true,
  },
  {
    name: 'fetch',
    'network.protocol.name': 'http',
    'network.protocol.version': 'HTTP/1.1',
    'http.request.method': 'POST',
    'url.full': 'http://d1/query?resultsFormat=ROWS_AND_COLUMNS',
    'http.request.header.content-type': 'application/json',
    'http.request.body.size': 61n,
    'http.response.status_code': 200n,
    'http.response.body.size': 292n,
    closed: true,
  },
  {
    name: 'd1_raw',
    'db.system.name': 'cloudflare-d1',
    'db.operation.name': 'raw',
    'cloudflare.binding.type': 'D1',
    'cloudflare.d1.query.statement': 'SELECT * FROM users WHERE user_id = ?;',
    'cloudflare.d1.response.size_after': 8192,
    'cloudflare.d1.response.rows_read': 1,
    'cloudflare.d1.response.rows_written': 0,
    'cloudflare.d1.response.last_row_id': 2,
    'cloudflare.d1.response.changed_db': false,
    'cloudflare.d1.response.changes': 0,
    closed: true,
  },
  {
    name: 'fetch',
    'network.protocol.name': 'http',
    'network.protocol.version': 'HTTP/1.1',
    'http.request.method': 'POST',
    'url.full': 'http://d1/query?resultsFormat=ROWS_AND_COLUMNS',
    'http.request.header.content-type': 'application/json',
    'http.request.body.size': 61n,
    'http.response.status_code': 200n,
    'http.response.body.size': 293n,
    closed: true,
  },
  {
    name: 'd1_first',
    'db.system.name': 'cloudflare-d1',
    'db.operation.name': 'first',
    'cloudflare.binding.type': 'D1',
    'cloudflare.d1.query.statement': 'SELECT * FROM users WHERE user_id = ?;',
    'cloudflare.d1.response.size_after': 8192,
    'cloudflare.d1.response.rows_read': 1,
    'cloudflare.d1.response.rows_written': 0,
    'cloudflare.d1.response.last_row_id': 2,
    'cloudflare.d1.response.changed_db': false,
    'cloudflare.d1.response.changes': 0,
    closed: true,
  },
  {
    name: 'fetch',
    'network.protocol.name': 'http',
    'network.protocol.version': 'HTTP/1.1',
    'http.request.method': 'POST',
    'url.full': 'http://d1/query?resultsFormat=ROWS_AND_COLUMNS',
    'http.request.header.content-type': 'application/json',
    'http.request.body.size': 61n,
    'http.response.status_code': 200n,
    'http.response.body.size': 293n,
    closed: true,
  },
  {
    name: 'd1_first',
    'db.system.name': 'cloudflare-d1',
    'db.operation.name': 'first',
    'cloudflare.binding.type': 'D1',
    'cloudflare.d1.query.statement': 'SELECT * FROM users WHERE user_id = ?;',
    'cloudflare.d1.response.size_after': 8192,
    'cloudflare.d1.response.rows_read': 1,
    'cloudflare.d1.response.rows_written': 0,
    'cloudflare.d1.response.last_row_id': 2,
    'cloudflare.d1.response.changed_db': false,
    'cloudflare.d1.response.changes': 0,
    closed: true,
  },
  {
    name: 'fetch',
    'network.protocol.name': 'http',
    'network.protocol.version': 'HTTP/1.1',
    'http.request.method': 'POST',
    'url.full': 'http://d1/query?resultsFormat=ROWS_AND_COLUMNS',
    'http.request.header.content-type': 'application/json',
    'http.request.body.size': 61n,
    'http.response.status_code': 200n,
    'http.response.body.size': 291n,
    closed: true,
  },
  {
    name: 'd1_all',
    'db.system.name': 'cloudflare-d1',
    'db.operation.name': 'all',
    'cloudflare.binding.type': 'D1',
    'cloudflare.d1.query.statement': 'SELECT * FROM users WHERE user_id = ?;',
    'cloudflare.d1.response.size_after': 8192,
    'cloudflare.d1.response.rows_read': 1,
    'cloudflare.d1.response.rows_written': 0,
    'cloudflare.d1.response.last_row_id': 2,
    'cloudflare.d1.response.changed_db': false,
    'cloudflare.d1.response.changes': 0,
    closed: true,
  },
  {
    name: 'fetch',
    'network.protocol.name': 'http',
    'network.protocol.version': 'HTTP/1.1',
    'http.request.method': 'POST',
    'url.full': 'http://d1/query?resultsFormat=ROWS_AND_COLUMNS',
    'http.request.header.content-type': 'application/json',
    'http.request.body.size': 61n,
    'http.response.status_code': 200n,
    'http.response.body.size': 292n,
    closed: true,
  },
  {
    name: 'd1_raw',
    'db.system.name': 'cloudflare-d1',
    'db.operation.name': 'raw',
    'cloudflare.binding.type': 'D1',
    'cloudflare.d1.query.statement': 'SELECT * FROM users WHERE user_id = ?;',
    'cloudflare.d1.response.size_after': 8192,
    'cloudflare.d1.response.rows_read': 1,
    'cloudflare.d1.response.rows_written': 0,
    'cloudflare.d1.response.last_row_id': 2,
    'cloudflare.d1.response.changed_db': false,
    'cloudflare.d1.response.changes': 0,
    closed: true,
  },
  {
    name: 'fetch',
    'network.protocol.name': 'http',
    'network.protocol.version': 'HTTP/1.1',
    'http.request.method': 'POST',
    'url.full': 'http://d1/query?resultsFormat=ROWS_AND_COLUMNS',
    'http.request.header.content-type': 'application/json',
    'http.request.body.size': 61n,
    'http.response.status_code': 200n,
    'http.response.body.size': 292n,
    closed: true,
  },
  {
    name: 'd1_first',
    'db.system.name': 'cloudflare-d1',
    'db.operation.name': 'first',
    'cloudflare.binding.type': 'D1',
    'cloudflare.d1.query.statement': 'SELECT * FROM users WHERE user_id = ?;',
    'cloudflare.d1.response.size_after': 8192,
    'cloudflare.d1.response.rows_read': 1,
    'cloudflare.d1.response.rows_written': 0,
    'cloudflare.d1.response.last_row_id': 2,
    'cloudflare.d1.response.changed_db': false,
    'cloudflare.d1.response.changes': 0,
    closed: true,
  },
  {
    name: 'fetch',
    'network.protocol.name': 'http',
    'network.protocol.version': 'HTTP/1.1',
    'http.request.method': 'POST',
    'url.full': 'http://d1/query?resultsFormat=ROWS_AND_COLUMNS',
    'http.request.header.content-type': 'application/json',
    'http.request.body.size': 61n,
    'http.response.status_code': 200n,
    'http.response.body.size': 293n,
    closed: true,
  },
  {
    name: 'd1_first',
    'db.system.name': 'cloudflare-d1',
    'db.operation.name': 'first',
    'cloudflare.binding.type': 'D1',
    'cloudflare.d1.query.statement': 'SELECT * FROM users WHERE user_id = ?;',
    'cloudflare.d1.response.size_after': 8192,
    'cloudflare.d1.response.rows_read': 1,
    'cloudflare.d1.response.rows_written': 0,
    'cloudflare.d1.response.last_row_id': 2,
    'cloudflare.d1.response.changed_db': false,
    'cloudflare.d1.response.changes': 0,
    closed: true,
  },
  {
    name: 'fetch',
    'network.protocol.name': 'http',
    'network.protocol.version': 'HTTP/1.1',
    'http.request.method': 'POST',
    'url.full': 'http://d1/query?resultsFormat=ROWS_AND_COLUMNS',
    'http.request.header.content-type': 'application/json',
    'http.request.body.size': 125n,
    'http.response.status_code': 200n,
    'http.response.body.size': 587n,
    closed: true,
  },
  {
    name: 'd1_batch',
    'cloudflare.d1.query.statements.count': 2,
    'cloudflare.d1.response.size_after': 16384,
    'cloudflare.d1.response.rows_read': 2,
    'cloudflare.d1.response.rows_written': 0,
    'cloudflare.d1.response.last_row_id': 2,
    'cloudflare.d1.response.changed_db': false,
    'cloudflare.d1.response.changes': 0,
    closed: true,
  },
  {
    name: 'fetch',
    'network.protocol.name': 'http',
    'network.protocol.version': 'HTTP/1.1',
    'http.request.method': 'POST',
    'url.full': 'http://d1/query?resultsFormat=ROWS_AND_COLUMNS',
    'http.request.header.content-type': 'application/json',
    'http.request.body.size': 79n,
    'http.response.status_code': 200n,
    'http.response.body.size': 221n,
    closed: true,
  },
  {
    name: 'd1_first',
    'db.system.name': 'cloudflare-d1',
    'db.operation.name': 'first',
    'cloudflare.binding.type': 'D1',
    'cloudflare.d1.query.statement':
      'SELECT count(1) as count FROM users WHERE land_based = ?',
    'cloudflare.d1.response.size_after': 8192,
    'cloudflare.d1.response.rows_read': 2,
    'cloudflare.d1.response.rows_written': 0,
    'cloudflare.d1.response.last_row_id': 2,
    'cloudflare.d1.response.changed_db': false,
    'cloudflare.d1.response.changes': 0,
    closed: true,
  },
  {
    name: 'fetch',
    'network.protocol.name': 'http',
    'network.protocol.version': 'HTTP/1.1',
    'http.request.method': 'POST',
    'url.full': 'http://d1/query?resultsFormat=ROWS_AND_COLUMNS',
    'http.request.header.content-type': 'application/json',
    'http.request.body.size': 79n,
    'http.response.status_code': 200n,
    'http.response.body.size': 220n,
    closed: true,
  },
  {
    name: 'd1_first',
    'db.system.name': 'cloudflare-d1',
    'db.operation.name': 'first',
    'cloudflare.binding.type': 'D1',
    'cloudflare.d1.query.statement':
      'SELECT count(1) as count FROM users WHERE land_based = ?',
    'cloudflare.d1.response.size_after': 8192,
    'cloudflare.d1.response.rows_read': 2,
    'cloudflare.d1.response.rows_written': 0,
    'cloudflare.d1.response.last_row_id': 2,
    'cloudflare.d1.response.changed_db': false,
    'cloudflare.d1.response.changes': 0,
    closed: true,
  },
  {
    name: 'fetch',
    'network.protocol.name': 'http',
    'network.protocol.version': 'HTTP/1.1',
    'http.request.method': 'POST',
    'url.full': 'http://d1/query?resultsFormat=ROWS_AND_COLUMNS',
    'http.request.header.content-type': 'application/json',
    'http.request.body.size': 79n,
    'http.response.status_code': 200n,
    'http.response.body.size': 220n,
    closed: true,
  },
  {
    name: 'd1_first',
    'db.system.name': 'cloudflare-d1',
    'db.operation.name': 'first',
    'cloudflare.binding.type': 'D1',
    'cloudflare.d1.query.statement':
      'SELECT count(1) as count FROM users WHERE land_based = ?',
    'cloudflare.d1.response.size_after': 8192,
    'cloudflare.d1.response.rows_read': 2,
    'cloudflare.d1.response.rows_written': 0,
    'cloudflare.d1.response.last_row_id': 2,
    'cloudflare.d1.response.changed_db': false,
    'cloudflare.d1.response.changes': 0,
    closed: true,
  },
  {
    name: 'fetch',
    'network.protocol.name': 'http',
    'network.protocol.version': 'HTTP/1.1',
    'http.request.method': 'POST',
    'url.full': 'http://d1/query?resultsFormat=ROWS_AND_COLUMNS',
    'http.request.header.content-type': 'application/json',
    'http.request.body.size': 79n,
    'http.response.status_code': 200n,
    'http.response.body.size': 220n,
    closed: true,
  },
  {
    name: 'd1_first',
    'db.system.name': 'cloudflare-d1',
    'db.operation.name': 'first',
    'cloudflare.binding.type': 'D1',
    'cloudflare.d1.query.statement':
      'SELECT count(1) as count FROM users WHERE land_based = ?',
    'cloudflare.d1.response.size_after': 8192,
    'cloudflare.d1.response.rows_read': 2,
    'cloudflare.d1.response.rows_written': 0,
    'cloudflare.d1.response.last_row_id': 2,
    'cloudflare.d1.response.changed_db': false,
    'cloudflare.d1.response.changes': 0,
    closed: true,
  },
  {
    name: 'fetch',
    'network.protocol.name': 'http',
    'network.protocol.version': 'HTTP/1.1',
    'http.request.method': 'POST',
    'url.full': 'http://d1/query?resultsFormat=ROWS_AND_COLUMNS',
    'http.request.header.content-type': 'application/json',
    'http.request.body.size': 79n,
    'http.response.status_code': 200n,
    'http.response.body.size': 220n,
    closed: true,
  },
  {
    name: 'd1_first',
    'db.system.name': 'cloudflare-d1',
    'db.operation.name': 'first',
    'cloudflare.binding.type': 'D1',
    'cloudflare.d1.query.statement':
      'SELECT count(1) as count FROM users WHERE land_based = ?',
    'cloudflare.d1.response.size_after': 8192,
    'cloudflare.d1.response.rows_read': 2,
    'cloudflare.d1.response.rows_written': 0,
    'cloudflare.d1.response.last_row_id': 2,
    'cloudflare.d1.response.changed_db': false,
    'cloudflare.d1.response.changes': 0,
    closed: true,
  },
  {
    name: 'fetch',
    'network.protocol.name': 'http',
    'network.protocol.version': 'HTTP/1.1',
    'http.request.method': 'POST',
    'url.full': 'http://d1/query?resultsFormat=ROWS_AND_COLUMNS',
    'http.request.header.content-type': 'application/json',
    'http.request.body.size': 298n,
    'http.response.status_code': 200n,
    'http.response.body.size': 846n,
    closed: true,
  },
  {
    name: 'd1_batch',
    'cloudflare.d1.query.statements.count': 4,
    'cloudflare.d1.response.size_after': 61440,
    'cloudflare.d1.response.rows_read': 2,
    'cloudflare.d1.response.rows_written': 9,
    'cloudflare.d1.response.last_row_id': 3,
    'cloudflare.d1.response.changed_db': false,
    'cloudflare.d1.response.changes': 0,
    closed: true,
  },
  {
    name: 'fetch',
    'network.protocol.name': 'http',
    'network.protocol.version': 'HTTP/1.1',
    'http.request.method': 'POST',
    'url.full': 'http://d1/query?resultsFormat=ROWS_AND_COLUMNS',
    'http.request.header.content-type': 'application/json',
    'http.request.body.size': 45n,
    'http.response.status_code': 200n,
    'http.response.body.size': 353n,
    closed: true,
  },
  {
    name: 'd1_all',
    'db.system.name': 'cloudflare-d1',
    'db.operation.name': 'all',
    'cloudflare.binding.type': 'D1',
    'cloudflare.d1.query.statement': 'SELECT * FROM abc, cde;',
    'cloudflare.d1.response.size_after': 16384,
    'cloudflare.d1.response.rows_read': 8,
    'cloudflare.d1.response.rows_written': 0,
    'cloudflare.d1.response.last_row_id': 3,
    'cloudflare.d1.response.changed_db': false,
    'cloudflare.d1.response.changes': 0,
    closed: true,
  },
  {
    name: 'fetch',
    'network.protocol.name': 'http',
    'network.protocol.version': 'HTTP/1.1',
    'http.request.method': 'POST',
    'url.full': 'http://d1/query?resultsFormat=ROWS_AND_COLUMNS',
    'http.request.header.content-type': 'application/json',
    'http.request.body.size': 45n,
    'http.response.status_code': 200n,
    'http.response.body.size': 353n,
    closed: true,
  },
  {
    name: 'd1_raw',
    'db.system.name': 'cloudflare-d1',
    'db.operation.name': 'raw',
    'cloudflare.binding.type': 'D1',
    'cloudflare.d1.query.statement': 'SELECT * FROM abc, cde;',
    'cloudflare.d1.response.size_after': 16384,
    'cloudflare.d1.response.rows_read': 8,
    'cloudflare.d1.response.rows_written': 0,
    'cloudflare.d1.response.last_row_id': 3,
    'cloudflare.d1.response.changed_db': false,
    'cloudflare.d1.response.changes': 0,
    closed: true,
  },
  {
    name: 'fetch',
    'network.protocol.name': 'http',
    'network.protocol.version': 'HTTP/1.1',
    'http.request.method': 'POST',
    'url.full': 'http://d1/query?resultsFormat=ROWS_AND_COLUMNS',
    'http.request.header.content-type': 'application/json',
    'http.request.body.size': 45n,
    'http.response.status_code': 200n,
    'http.response.body.size': 353n,
    closed: true,
  },
  {
    name: 'd1_raw',
    'db.system.name': 'cloudflare-d1',
    'db.operation.name': 'raw',
    'cloudflare.binding.type': 'D1',
    'cloudflare.d1.query.statement': 'SELECT * FROM abc, cde;',
    'cloudflare.d1.response.size_after': 16384,
    'cloudflare.d1.response.rows_read': 8,
    'cloudflare.d1.response.rows_written': 0,
    'cloudflare.d1.response.last_row_id': 3,
    'cloudflare.d1.response.changed_db': false,
    'cloudflare.d1.response.changes': 0,
    closed: true,
  },
  {
    name: 'fetch',
    'network.protocol.name': 'http',
    'network.protocol.version': 'HTTP/1.1',
    'http.request.method': 'POST',
    'url.full': 'http://d1/query?resultsFormat=ROWS_AND_COLUMNS',
    'http.request.header.content-type': 'application/json',
    'http.request.body.size': 45n,
    'http.response.status_code': 200n,
    'http.response.body.size': 353n,
    closed: true,
  },
  {
    name: 'd1_raw',
    'db.system.name': 'cloudflare-d1',
    'db.operation.name': 'raw',
    'cloudflare.binding.type': 'D1',
    'cloudflare.d1.query.statement': 'SELECT * FROM abc, cde;',
    'cloudflare.d1.response.size_after': 16384,
    'cloudflare.d1.response.rows_read': 8,
    'cloudflare.d1.response.rows_written': 0,
    'cloudflare.d1.response.last_row_id': 3,
    'cloudflare.d1.response.changed_db': false,
    'cloudflare.d1.response.changes': 0,
    closed: true,
  },
  {
    name: 'fetch',
    'network.protocol.name': 'http',
    'network.protocol.version': 'HTTP/1.1',
    'http.request.method': 'POST',
    'url.full': 'http://d1/query?resultsFormat=ROWS_AND_COLUMNS',
    'http.request.header.content-type': 'application/json',
    'http.request.body.size': 76n,
    'http.response.status_code': 200n,
    'http.response.body.size': 235n,
    closed: true,
  },
  {
    name: 'd1_all',
    'db.system.name': 'cloudflare-d1',
    'db.operation.name': 'all',
    'cloudflare.binding.type': 'D1',
    'cloudflare.d1.query.statement':
      "SELECT * from cde WHERE c IN ('A','B','C','X','Y','Z')",
    'cloudflare.d1.response.size_after': 16384,
    'cloudflare.d1.response.rows_read': 3,
    'cloudflare.d1.response.rows_written': 0,
    'cloudflare.d1.response.last_row_id': 3,
    'cloudflare.d1.response.changed_db': false,
    'cloudflare.d1.response.changes': 0,
    closed: true,
  },
  {
    name: 'fetch',
    'network.protocol.name': 'http',
    'network.protocol.version': 'HTTP/1.1',
    'http.request.method': 'POST',
    'url.full': 'http://d1/query?resultsFormat=ROWS_AND_COLUMNS',
    'http.request.header.content-type': 'application/json',
    'http.request.body.size': 117n,
    'http.response.status_code': 200n,
    'http.response.body.size': 633n,
    closed: true,
  },
  {
    name: 'd1_batch',
    'cloudflare.d1.query.statements.count': 3,
    'cloudflare.d1.response.size_after': 24576,
    'cloudflare.d1.response.rows_read': 9,
    'cloudflare.d1.response.rows_written': 0,
    'cloudflare.d1.response.last_row_id': 3,
    'cloudflare.d1.response.changed_db': false,
    'cloudflare.d1.response.changes': 0,
    closed: true,
  },
];
