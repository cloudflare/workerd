using Workerd = import "/workerd/workerd.capnp";

const unitTests :Workerd.Config = (
  services = [
    ( name = "access-jwt-test",
      worker = (
        modules = [
          (name = "worker", esModule = embed "access-jwt-test.js")
        ],
        compatibilityFlags = ["nodejs_compat", "experimental"],
        bindings = [
          (name = "mock", service = "access-jwt-mock"),
        ],
        # Route all outbound fetch requests through the mock service
        # This allows us to intercept calls to *.cloudflareaccess.com/cdn-cgi/access/certs
        globalOutbound = "access-jwt-mock",
      )
    ),
    ( name = "access-jwt-mock",
      worker = (
        compatibilityFlags = ["nodejs_compat", "experimental"],
        modules = [
          (name = "worker", esModule = embed "access-jwt-mock.js")
        ],
      )
    )
  ]
);
