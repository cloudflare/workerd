From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: James M Snell <jsnell@cloudflare.com>
Date: Thu, 6 Nov 2025 10:58:38 -0800
Subject: Add v8::String::IsFlat API

Tells us if a string is already flattened or not.

Signed-off-by: James M Snell <jsnell@cloudflare.com>

diff --git a/include/v8-primitive.h b/include/v8-primitive.h
index 87215cf6ece31d4d10392d93c3925ec10c3c138c..360bbe0bb33b58200f05f6d98b03e17316de9cce 100644
--- a/include/v8-primitive.h
+++ b/include/v8-primitive.h
@@ -157,6 +157,11 @@ class V8_EXPORT String : public Name {
    */
   bool ContainsOnlyOneByte() const;
 
+  /**
+   * Returns true if this string is flat
+   */
+  bool IsFlat() const;
+
   struct WriteFlags {
     enum {
       kNone = 0,
diff --git a/src/api/api.cc b/src/api/api.cc
index 3012edb6ce08c6417175c16e796eb4fb26b18af4..946a2154e793b1def5e783fd0eea2a286fa4ee54 100644
--- a/src/api/api.cc
+++ b/src/api/api.cc
@@ -5591,6 +5591,10 @@ bool String::IsOneByte() const {
   return Utils::OpenDirectHandle(this)->IsOneByteRepresentation();
 }
 
+bool String::IsFlat() const {
+  return Utils::OpenDirectHandle(this)->IsFlat();
+}
+
 // Helpers for ContainsOnlyOneByteHelper
 template <size_t size>
 struct OneByteMask;
